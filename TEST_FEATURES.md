# AutoPurge 新功能测试指南

## 新增功能

### 1. 密码保护功能
- **位置**: Options 页面 → Security 标签
- **功能**: 
  - 启用/禁用密码保护
  - 设置密码（最少6位）
  - 更新密码
  - 移除密码保护
- **安全特性**:
  - 使用 Web Crypto API 进行密码哈希
  - 随机盐值防止彩虹表攻击
  - 密码本地存储，无法恢复

### 2. 历史记录功能
- **位置**: Options 页面 → History Records 标签
- **功能**:
  - 查看被删除的浏览历史记录
  - 按时间过滤（今天/本周/本月）
  - 搜索历史记录
  - 导出历史记录为 JSON
  - 清空所有历史记录
  - 删除单个历史记录
- **设置选项**:
  - 自动记录删除（开关）
  - 最大记录数（100-10000）
  - 保留天数（1-365天）

## 测试步骤

### 测试密码功能
1. 打开扩展的 Options 页面
2. 点击 "Security" 标签
3. 启用密码保护，设置密码
4. 尝试更新密码
5. 尝试移除密码保护

### 测试历史记录功能
1. 打开扩展的 Options 页面
2. 点击 "History Records" 标签
3. 访问一些被监控的网站（如 google.com）
4. 等待历史记录被自动删除
5. 在 History Records 页面查看记录
6. 测试过滤和搜索功能
7. 测试导出功能

## 技术实现

### 密码保护
- 使用 `crypto.getRandomValues()` 生成盐值
- 使用 `crypto.subtle.digest()` 进行 SHA-256 哈希
- 密码配置存储在 `localStorage` 中

### 历史记录
- 历史记录存储在 `chrome.storage.local` 中
- 支持自动清理过期记录
- 支持记录数量限制
- 包含 URL、标题、域名、删除时间等信息

## 文件修改

### options.html
- 添加了 Security 和 History Records 两个新的内容区域
- 包含密码设置界面和历史记录查看界面

### options.js
- 添加了密码管理功能（生成盐值、哈希、验证）
- 添加了历史记录管理功能（显示、过滤、搜索、导出）
- 集成了 chrome.storage.local API

### background.js
- 修改了 `deleteFromHistory` 函数以记录删除的历史
- 添加了 `recordHistoryDeletion` 函数
- 支持历史记录设置（自动记录、最大记录数、保留天数）

## 注意事项

1. 密码功能完全在本地运行，无需后端
2. 历史记录功能也是本地存储，不会上传到服务器
3. 所有数据都存储在用户的浏览器中
4. 密码忘记后无法恢复，需要重新设置
5. 历史记录会占用本地存储空间，建议定期清理
